<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Software ninja - Install a Multipath TCP kernel on linux</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Ninja hacking</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Install a Multipath TCP kernel on linux</h1>
            <article>
    <section class="header">
    Posted on December  2, 2021
    
        by Matt
    
    </section>
    <section>
    
    Tags: 
    
    </section>
    <section>
<p>Multipath TCP (mptcp) is an extension of TCP (Transmission Control Protocol) to transfer data over multiple paths. This can be useful to download faster, make it harder to spy on your traffic or just for fiability/redundancy.</p>
<p>Even though it is an extension of TCP, the changes are deep enough that it could be considered a new protocol.</p>
<p>Nowadays there are two linux implementations that I know of: 1. the <a href="http://mutipath-tcp.org">legacy</a> one developed at UCL (Belgium) 2. recent linux kernel (&gt;= 5.13) also support basic MPTCP and add features with every new release.</p>
<p>Instructions to install 1) are available on their website so let’s focus on the official kernel.</p>
<p>Linux later than 5.13 contain MPTCP if it was enabled at compilation time. You can also control the behavior at runtime: <code>sysctl -a |grep mptcp</code> should return something similar to:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">net.ipv4.tcp_available_ulp</span> = mptcp</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="ex">net.mptcp.add_addr_timeout</span> = 120</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="ex">net.mptcp.allow_join_initial_addr_port</span> = 1</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="ex">net.mptcp.checksum_enabled</span> = 0</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="ex">net.mptcp.enabled</span> = 1      # <span class="op">&lt;</span>- at least this one !</span></code></pre></div>
<p>if it doesn’t check your kernel config, for instance with <code>zgrep MPTCP /proc/config.gz</code>. On a nixos 5.14.12 kernel, I get:</p>
<pre><code>CONFIG_MPTCP=y
CONFIG_INET_MPTCP_DIAG=m
CONFIG_MPTCP_IPV6=y
CONFIG_MPTCP_KUNIT_TEST=m</code></pre>
<p>Recompile your kernel with these options enabled and rebooting should fix it.</p>
    </section>
</article>

        </main>

        <footer>
            Site generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
